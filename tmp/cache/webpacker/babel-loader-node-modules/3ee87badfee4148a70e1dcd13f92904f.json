{"ast":null,"code":"import { Chatrooms, Chatroom } from \"../BackboneModel/chat_list_model\";\nimport { UsersChatroom } from \"../BackboneModel/users_chatroom_model\";\nimport { Friend, Friends } from \"../BackboneModel/friend_list_model\";\nimport { Battle, Battles } from \"../BackboneModel/battle_list_model\";\nimport { Ban } from \"../BackboneModel/ban_model\";\nvar FriendListView = Backbone.View.extend({\n  initialize: function initialize(options) {\n    this.bus = options.bus;\n  },\n  events: {\n    \"click .speech-friend\": \"onClick\"\n  },\n  onClick: function onClick(e) {\n    this.bus.trigger(\"friendChatroomSelected\", this.model);\n  },\n  render: function render() {\n    var right_buttons = '<p class=\"speech-friend social-hover\">üí¨</p><p class=\"mute-friend social-hover\">' + (this.model.get(\"i_mute\") ? 'üîá' : 'üîâ') + '</p><p class=\"flb quite-friend social-hover\">‚úñ</p>';\n    this.$el.html('<li class=\"friend\">\\\n            <p class=\"friend-name ' + (this.model.get('onsite') == true ? 'green-dot ' : 'red-dot ') + 'social-hover\">' + this.model.get(\"pseudo\") + '</p>' + right_buttons + '</li>');\n    return this;\n  }\n});\nvar FriendListViews = Backbone.View.extend({\n  el: \".friend-list\",\n  initialize: function initialize(options) {\n    var self = this;\n    this.friends = new Friends();\n    this.search_is_open = false;\n    this.bus = options.bus;\n    this.users = options.users;\n    this.profilView = options.profilView;\n    this.bus.on(\"refreshFriendsList\", this.refreshFriendsList, this);\n  },\n  refreshFriendsList: function refreshFriendsList(e) {\n    if (e.status != undefined) {\n      if (e.status) {\n        $(\".friend-name:contains('\" + e.pseudo + \"')\").addClass('green-dot');\n        $(\".friend-name:contains('\" + e.pseudo + \"')\").removeClass('red-dot');\n      } else {\n        $(\".friend-name:contains('\" + e.pseudo + \"')\").addClass('red-dot');\n        $(\".friend-name:contains('\" + e.pseudo + \"')\").removeClass('green-dot');\n      }\n    }\n  },\n  generateSearchList: function generateSearchList() {\n    var self = this;\n    $(\"#search-friend-corps\").html('<ul id=\"friend-search-list\">\\\n        </ul>');\n    this.users.fetch({\n      data: {\n        pseudo: $(\"#input-button-search-friend\").val(),\n        findby: \"friend\"\n      }\n    }).then(function () {\n      $(\"#friend-search-list\").html(\"\");\n      self.users.each(function (user) {\n        $(\"#friend-search-list\").append('<li class=\"friend\">\\\n                <p class=\"title-friend-search social-hover\">' + user.get(\"pseudo\") + '</p>' + (user.get(\"blocked\") == false && user.get(\"invitation\") != \"cant_do_anything\" ? '<p class=\"user-invitation social-hover\">' + (user.get(\"invitation\") == \"can_invite\" ? '‚úã' : '‚ùå') + '</p>' : '') + (user.get(\"blocked\") == false && user.get(\"battle\") != \"cant_do_anything\" ? '<p class=\"user-challenge social-hover\">' + (user.get(\"battle\") == \"can_invite\" ? '‚öî' : '‚ùå') + '</p>' : '') + (user.get(\"are_friend\") == false ? '<p class=\"user-ban social-hover\">' + (user.get(\"blocked\") == true ? 'üè¥' : 'üè≥') + '</p>' : '') + '</li>');\n      });\n      $(\"p.title-friend-search\").click(function (e) {\n        self.profilView.render(self, e);\n      });\n      $(\".user-invitation\").click(function (e) {\n        if ($(e.currentTarget).html() == '‚úã') {\n          var friend = new Friend({\n            pseudo: $(e.currentTarget).prev().html()\n          });\n          friend.save().then(function () {\n            self.render();\n          });\n        } else if ($(e.currentTarget).html() == '‚ùå') {\n          var friend = new Friend({\n            id: $(e.currentTarget).prev().html()\n          });\n          friend.destroy().then(function () {\n            self.render();\n          });\n        }\n      });\n      $(\".user-challenge\").click(function (e) {\n        var left_pseudo = $(e.currentTarget).prev().html();\n        if (left_pseudo == '‚úã' || left_pseudo == '‚ùå') left_pseudo = $(e.currentTarget).prev().prev().html();\n\n        if ($(e.currentTarget).html() == '‚öî') {\n          var battle = new Battle({\n            pseudo: left_pseudo,\n            type_battle: 'casual'\n          });\n          battle.save().then(function () {\n            self.render();\n          });\n        } else if ($(e.currentTarget).html() == '‚ùå') {\n          var battle = new Battle({\n            id: left_pseudo\n          });\n          battle.destroy({\n            data: {\n              type_battle: 'casual'\n            },\n            processData: true\n          }).then(function () {\n            self.render();\n          });\n        }\n      });\n      $(\".user-ban\").click(function (e) {\n        var left_pseudo = $(e.currentTarget).prev().html();\n\n        if (left_pseudo == '‚úã' || left_pseudo == '‚ùå' || left_pseudo == '‚öî') {\n          left_pseudo = $(e.currentTarget).prev().prev().html();\n\n          if (left_pseudo == '‚úã' || left_pseudo == '‚ùå' || left_pseudo == '‚öî') {\n            left_pseudo = $(e.currentTarget).prev().prev().prev().html();\n          }\n        }\n\n        if ($(e.currentTarget).html() == 'üè¥') {\n          var ban = new Ban({\n            id: left_pseudo,\n            new_status: false\n          });\n          ban.save().then(function () {\n            self.render();\n          });\n        } else if ($(e.currentTarget).html() == 'üè≥') {\n          var ban = new Ban({\n            id: left_pseudo,\n            new_status: true\n          });\n          ban.save().then(function () {\n            self.render();\n          });\n        }\n      });\n    });\n  },\n  events: {\n    \"click #right-button-friend\": \"onClickForSearch\",\n    \"click .user-leave\": \"onClickForLeave\"\n  },\n  onClickForSearch: function onClickForSearch() {\n    var self = this;\n\n    if (this.search_is_open == false) {\n      $(\"#friend-list\").prepend('<div id=\"search-friend\">\\\n                    <input type=\"text\" id=\"input-button-search-friend\"><p class=\"show-more-friend social-hover\">C</p>\\\n                    <div id=\"search-friend-corps\">\\\n                    </div>\\\n                </div>');\n      $(\"#input-button-search-friend\").keyup(function (e) {\n        self.generateSearchList();\n      });\n      self.generateSearchList();\n      $(\"#right-button-friend\").html(\"‚àí\");\n      $(\"#right-button-friend\").css(\"background\", \"red\");\n      this.search_is_open = true;\n    } else {\n      $(\"#right-button-friend\").html(\"‚úö\");\n      $(\"#right-button-friend\").css(\"background\", \"green\");\n      $(\"#search-friend\").remove();\n      this.search_is_open = false;\n    }\n  },\n  quite_friend: function quite_friend() {\n    var self = this;\n    $(\".quite-friend\").click(function (e) {\n      var friend = new Friend({\n        id: $(e.currentTarget).prev().prev().prev().html()\n      });\n      friend.destroy().then(function () {\n        self.render();\n      });\n    });\n  },\n  mute_friend: function mute_friend() {\n    var self = this;\n    $(\".mute-friend\").click(function (e) {\n      var mute = $(e.currentTarget).html() == 'üîâ' ? true : false;\n      var friend = new Friend({\n        id: $(e.currentTarget).prev().prev().html(),\n        order: 'mute-friend',\n        mute: mute\n      });\n      friend.save().then(function () {\n        if (!mute && $(\"#chat-top-bar > p#center\").html() == $(e.currentTarget).prev().prev().html()) {\n          self.bus.trigger(\"friendChatroomRefresh\", this.model);\n        }\n\n        self.render();\n      });\n    });\n  },\n  render: function render() {\n    var self = this;\n    self.ProfilIsOpen = false;\n    this.search_is_open = false;\n    this.$el.html('<div id=\"friend-list\">\\\n            <div id=\"friend-list-top-bar\">\\\n                <p id=\"center-friend-list-top-bar\">YourFriends</p><p id=\"right-button-friend\" class=\"social-hover\">‚úö</p>\\\n            </div>\\\n            <ul id=\"friend-list-container\">\\\n            </ul>\\\n            </div>');\n    $(\"#right-button-friend\").css(\"background\", \"green\");\n    self.model.fetch().then(function () {\n      self.$el.find(\"ul#friend-list-container\").html('');\n      self.model.each(function (friend) {\n        var friendListView = new FriendListView({\n          model: friend,\n          bus: self.bus\n        });\n        self.$el.find(\"ul#friend-list-container\").append(friendListView.render().$el);\n      });\n      self.quite_friend();\n      self.mute_friend();\n      $(\".friend-name.social-hover\").click(function (e) {\n        self.profilView.render(self, e);\n      });\n      return self;\n    });\n  }\n});\nexport { FriendListViews };","map":{"version":3,"sources":["/home/mathis/Documents/final/app/javascript/BackboneViews/FriendListView.js"],"names":["Chatrooms","Chatroom","UsersChatroom","Friend","Friends","Battle","Battles","Ban","FriendListView","Backbone","View","extend","initialize","options","bus","events","onClick","e","trigger","model","render","right_buttons","get","$el","html","FriendListViews","el","self","friends","search_is_open","users","profilView","on","refreshFriendsList","status","undefined","$","pseudo","addClass","removeClass","generateSearchList","fetch","data","val","findby","then","each","user","append","click","currentTarget","friend","prev","save","id","destroy","left_pseudo","battle","type_battle","processData","ban","new_status","onClickForSearch","prepend","keyup","css","remove","quite_friend","mute_friend","mute","order","ProfilIsOpen","find","friendListView"],"mappings":"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","sourcesContent":["import { Chatrooms, Chatroom } from \"../BackboneModel/chat_list_model\"\nimport { UsersChatroom } from \"../BackboneModel/users_chatroom_model\"\nimport { Friend, Friends } from \"../BackboneModel/friend_list_model\"\nimport { Battle, Battles } from \"../BackboneModel/battle_list_model\"\nimport { Ban } from \"../BackboneModel/ban_model\"\n\n\nvar FriendListView = Backbone.View.extend({\n\n    initialize: function (options) {\n        this.bus = options.bus;\n    },\n\n    events: {\n        \"click .speech-friend\": \"onClick\"\n    },\n\n    onClick: function (e) {\n        this.bus.trigger(\"friendChatroomSelected\", this.model)\n    },\n\n    render: function () {\n        var right_buttons = '<p class=\"speech-friend social-hover\">üí¨</p><p class=\"mute-friend social-hover\">' + (this.model.get(\"i_mute\") ? 'üîá' : 'üîâ') + '</p><p class=\"flb quite-friend social-hover\">‚úñ</p>'\n        this.$el.html('<li class=\"friend\">\\\n            <p class=\"friend-name ' + (this.model.get('onsite') == true ? 'green-dot ' : 'red-dot ') + 'social-hover\">' + this.model.get(\"pseudo\") + '</p>' + right_buttons + '</li>')\n        return this;\n    }\n});\n\nvar FriendListViews = Backbone.View.extend({\n    el: \".friend-list\",\n\n    initialize: function (options) {\n        var self = this;\n        this.friends = new Friends();\n        this.search_is_open = false;\n        this.bus = options.bus;\n        this.users = options.users;\n        this.profilView = options.profilView;\n        this.bus.on(\"refreshFriendsList\", this.refreshFriendsList, this);\n    },\n\n    refreshFriendsList: function (e) {\n        if (e.status != undefined) {\n            if (e.status) {\n                $(\".friend-name:contains('\" + e.pseudo + \"')\").addClass('green-dot')\n                $(\".friend-name:contains('\" + e.pseudo + \"')\").removeClass('red-dot')\n            } else {\n                $(\".friend-name:contains('\" + e.pseudo + \"')\").addClass('red-dot')\n                $(\".friend-name:contains('\" + e.pseudo + \"')\").removeClass('green-dot')\n            }\n        }\n    },\n\n    generateSearchList: function () {\n        var self = this;\n        $(\"#search-friend-corps\").html('<ul id=\"friend-search-list\">\\\n        </ul>');\n        this.users.fetch({ data: { pseudo: $(\"#input-button-search-friend\").val(), findby: \"friend\" } }).then(function () {\n            $(\"#friend-search-list\").html(\"\");\n            self.users.each(function (user) {\n                $(\"#friend-search-list\").append('<li class=\"friend\">\\\n                <p class=\"title-friend-search social-hover\">' +\n                    user.get(\"pseudo\") + '</p>' +\n                    (user.get(\"blocked\") == false && user.get(\"invitation\") != \"cant_do_anything\" ? '<p class=\"user-invitation social-hover\">' + (user.get(\"invitation\") == \"can_invite\" ? '‚úã' : '‚ùå') + '</p>' : '') +\n                    (user.get(\"blocked\") == false && user.get(\"battle\") != \"cant_do_anything\" ? '<p class=\"user-challenge social-hover\">' + (user.get(\"battle\") == \"can_invite\" ? '‚öî' : '‚ùå') + '</p>' : '') +\n                    (user.get(\"are_friend\") == false ? '<p class=\"user-ban social-hover\">' + (user.get(\"blocked\") == true ? 'üè¥' : 'üè≥') + '</p>' : '') +\n                    '</li>')\n            })\n            $(\"p.title-friend-search\").click(function (e) {\n                self.profilView.render(self, e);\n            })\n            $(\".user-invitation\").click(function (e) {\n                if ($(e.currentTarget).html() == '‚úã') {\n                    var friend = new Friend({ pseudo: $(e.currentTarget).prev().html() })\n                    friend.save().then(function () {\n                        self.render();\n                    })\n                } else if ($(e.currentTarget).html() == '‚ùå') {\n                    var friend = new Friend({ id: $(e.currentTarget).prev().html() })\n                    friend.destroy().then(function () {\n                        self.render();\n                    })\n                }\n            })\n            $(\".user-challenge\").click(function (e) {\n                var left_pseudo = $(e.currentTarget).prev().html();\n                if (left_pseudo == '‚úã' || left_pseudo == '‚ùå')\n                    left_pseudo = $(e.currentTarget).prev().prev().html();\n                if ($(e.currentTarget).html() == '‚öî') {\n                    var battle = new Battle({ pseudo: left_pseudo, type_battle: 'casual' })\n                    battle.save().then(function () {\n                        self.render();\n                    })\n                } else if ($(e.currentTarget).html() == '‚ùå') {\n                    var battle = new Battle({ id: left_pseudo })\n                    battle.destroy({ data: { type_battle: 'casual' }, processData: true }).then(function () {\n                        self.render();\n                    })\n                }\n            })\n            $(\".user-ban\").click(function (e) {\n                var left_pseudo = $(e.currentTarget).prev().html();\n                if (left_pseudo == '‚úã' || left_pseudo == '‚ùå' || left_pseudo == '‚öî') {\n                    left_pseudo = $(e.currentTarget).prev().prev().html();\n                    if (left_pseudo == '‚úã' || left_pseudo == '‚ùå' || left_pseudo == '‚öî') {\n                        left_pseudo = $(e.currentTarget).prev().prev().prev().html();\n                    }\n                }\n                if ($(e.currentTarget).html() == 'üè¥') {\n                    var ban = new Ban({ id: left_pseudo, new_status: false })\n                    ban.save().then(function () {\n                        self.render();\n                    })\n                } else if ($(e.currentTarget).html() == 'üè≥') {\n                    var ban = new Ban({ id: left_pseudo, new_status: true })\n                    ban.save().then(function () {\n                        self.render();\n                    })\n                }\n            })\n        });\n    },\n\n    events: {\n        \"click #right-button-friend\": \"onClickForSearch\",\n        \"click .user-leave\": \"onClickForLeave\"\n    },\n\n    onClickForSearch: function () {\n        var self = this;\n        if (this.search_is_open == false) {\n            $(\"#friend-list\").prepend('<div id=\"search-friend\">\\\n                    <input type=\"text\" id=\"input-button-search-friend\"><p class=\"show-more-friend social-hover\">C</p>\\\n                    <div id=\"search-friend-corps\">\\\n                    </div>\\\n                </div>')\n            $(\"#input-button-search-friend\").keyup(function (e) {\n                self.generateSearchList();\n            })\n            self.generateSearchList();\n            $(\"#right-button-friend\").html(\"‚àí\")\n            $(\"#right-button-friend\").css(\"background\", \"red\")\n            this.search_is_open = true;\n        }\n        else {\n            $(\"#right-button-friend\").html(\"‚úö\")\n            $(\"#right-button-friend\").css(\"background\", \"green\")\n            $(\"#search-friend\").remove()\n            this.search_is_open = false;\n        }\n    },\n\n    quite_friend: function () {\n        var self = this;\n        $(\".quite-friend\").click(function (e) {\n            var friend = new Friend({ id: $(e.currentTarget).prev().prev().prev().html() })\n            friend.destroy().then(function () {\n                self.render();\n            })\n        })\n    },\n\n    mute_friend: function () {\n        var self = this;\n        $(\".mute-friend\").click(function (e) {\n            var mute = $(e.currentTarget).html() == 'üîâ' ? true : false;\n            var friend = new Friend({ id: $(e.currentTarget).prev().prev().html(), order: 'mute-friend', mute: mute })\n            friend.save().then(function () {\n                if (!mute && $(\"#chat-top-bar > p#center\").html() == $(e.currentTarget).prev().prev().html()) {\n                    self.bus.trigger(\"friendChatroomRefresh\", this.model)\n                }\n                self.render();\n            })\n        })\n    },\n\n    render: function () {\n        var self = this;\n\n        self.ProfilIsOpen = false;\n        this.search_is_open = false\n        this.$el.html('<div id=\"friend-list\">\\\n            <div id=\"friend-list-top-bar\">\\\n                <p id=\"center-friend-list-top-bar\">YourFriends</p><p id=\"right-button-friend\" class=\"social-hover\">‚úö</p>\\\n            </div>\\\n            <ul id=\"friend-list-container\">\\\n            </ul>\\\n            </div>');\n        $(\"#right-button-friend\").css(\"background\", \"green\")\n        self.model.fetch().then(function () {\n            self.$el.find(\"ul#friend-list-container\").html('')\n            self.model.each(function (friend) {\n                var friendListView = new FriendListView({ model: friend, bus: self.bus })\n                self.$el.find(\"ul#friend-list-container\").append(friendListView.render().$el);\n            })\n            self.quite_friend();\n            self.mute_friend();\n            $(\".friend-name.social-hover\").click(function (e) {\n                self.profilView.render(self, e);\n            });\n            return self;\n        })\n    }\n});\n\nexport { FriendListViews }\n"]},"metadata":{},"sourceType":"module"}