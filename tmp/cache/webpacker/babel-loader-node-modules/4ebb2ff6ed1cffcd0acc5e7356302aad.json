{"ast":null,"code":"import consumer from \"./consumer\";\nimport { router } from \"../BackboneRouter/application_router\";\nimport { getCookie } from \"../utils/utils_1\";\n\nvar channel_gen = function channel_gen(channel_type, channel_name, channel_password, bus) {\n  var new_channel = consumer.subscriptions.create({\n    channel: channel_type,\n    room: channel_name,\n    password: channel_password\n  }, {\n    connected: function connected() {\n      $(\"#subscriber_count\").html(this.count);\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> connection etablie\");\n      new_channel.send({\n        start: true\n      });\n      this.connected = true;\n    },\n    disconnected: function disconnected() {\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> deconnection\");\n      $(\"#message-container\").html(\"vous avez été deconnecter du serveur pour une raison inconnu ...\");\n    },\n    rejected: function rejected() {\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> rejected\");\n      $(\"#message-container\").html(\"vous avez été banni du chat room\");\n    },\n    received: function received(data) {\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> received data\");\n\n      if (data[\"username\"] == \"server\") {\n        this.count = data[\"messageContent\"];\n        if (this.connected == true) $(\"#subscriber_count\").html(this.count);else $(\"#subscriber_count\").html(\"ban/error\");\n      } else if (data[\"username\"] == \"notification\") {\n        if (data[\"messageContent\"] == \"refresh\") {\n          if ($(\"#chat-top-bar > p#center\").html() != 'notification') {\n            bus.trigger(\"notificationReceived\", this);\n          } else {\n            bus.trigger(\"notificationSelected\", this);\n          }\n        } else if (data[\"messageContent\"] == \"battle-start\") {\n          router.navigate(\"connected/game?game_id=\".concat(data[\"battle_id\"]), {\n            trigger: true\n          });\n        }\n      } else if (data[\"username\"] == \"personnal-chat\") {\n        if ($(\"#chat-top-bar > p#center\").attr(\"friend-chat-open\") != undefined) {\n          if (data[\"forwarder\"] == $(\"#chat-top-bar > p#center\").html() || data[\"forwarder\"] == Cookies.get(\"pseudo\")) {\n            var down = false;\n\n            if ($('#message-container').scrollTop() + $('#message-container').innerHeight() >= $('#message-container')[0].scrollHeight) {\n              down = true;\n            }\n\n            var date = new Date(data[\"date\"]);\n            var date_string = date.getDay() + '/' + date.getMonth() + '/' + date.getFullYear() + '  ' + date.getHours() + ':' + date.getMinutes();\n            $(\"#message-container\").append('<li class=\"message\"><p class=\"user-message\">' + data[\"forwarder\"] + '</p><p class=\"time-message\">' + date_string + '</p><br><p class=\"content-message\">' + data[\"messageContent\"] + '</p></li>');\n            if (down == true) $(\"#message-container\").scrollTop($(\"#message-container\")[0].scrollHeight);\n          }\n        }\n      } else if (data[\"username\"] == \"friend-status\") {\n        bus.trigger(\"refreshFriendsList\", data);\n      } else if (data[\"username\"] == \"channel-ban\") {\n        bus.trigger(\"chatroomRefresh\", data);\n        alert('vous avez etait banni du chatroom [' + data[\"messageContent\"] + ']');\n      } else if (data[\"username\"] == \"channel-unban\") {\n        bus.trigger(\"chatroomRefresh\", data);\n        alert('vous avez etait debanni du chatroom [' + data[\"messageContent\"] + ']');\n      } else {\n        var date = new Date(data[\"date\"]);\n        var date_string = date.getDay() + '/' + date.getMonth() + '/' + date.getFullYear() + '  ' + date.getHours() + ':' + date.getMinutes();\n        var down = false;\n\n        if ($('#message-container').scrollTop() + $('#message-container').innerHeight() >= $('#message-container')[0].scrollHeight) {\n          down = true;\n        }\n\n        $(\"#message-container\").append('<li class=\"message\"><p class=\"user-message\">' + data[\"username\"] + '</p><p class=\"time-message\">' + date_string + '</p><br><p class=\"content-message\">' + data[\"messageContent\"] + '</p></li>');\n        if (down == true) $(\"#message-container\").scrollTop($(\"#message-container\")[0].scrollHeight);\n      }\n    }\n  });\n  return new_channel;\n};\n\nexport { channel_gen };","map":{"version":3,"sources":["/home/mathis/Documents/ancien/app/javascript/channels/chat_channel.js"],"names":["consumer","router","getCookie","channel_gen","channel_type","channel_name","channel_password","bus","new_channel","subscriptions","create","channel","room","password","connected","$","html","count","console","log","send","start","disconnected","rejected","received","data","trigger","navigate","attr","undefined","Cookies","get","down","scrollTop","innerHeight","scrollHeight","date","Date","date_string","getDay","getMonth","getFullYear","getHours","getMinutes","append","alert"],"mappings":"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","sourcesContent":["import consumer from \"./consumer\"\nimport { router } from \"../BackboneRouter/application_router\"\nimport { getCookie } from \"../utils/utils_1\";\n\nvar channel_gen = (channel_type, channel_name, channel_password, bus) => {\n  var new_channel = consumer.subscriptions.create({ channel: channel_type, room: channel_name, password: channel_password }, {\n\n    connected() {\n      $(\"#subscriber_count\").html(this.count)\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> connection etablie\")\n      new_channel.send({ start: true })\n      this.connected = true;\n    },\n\n    disconnected() {\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> deconnection\")\n      $(\"#message-container\").html(\"vous avez été deconnecter du serveur pour une raison inconnu ...\")\n    },\n\n    rejected() {\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> rejected\")\n      $(\"#message-container\").html(\"vous avez été banni du chat room\")\n    },\n\n    received(data) {\n      console.log(\"--- CHANNEL \" + channel_type + \"/\" + channel_name + \" >>> received data\")\n      if (data[\"username\"] == \"server\") {\n        this.count = data[\"messageContent\"];\n        if (this.connected == true)\n          $(\"#subscriber_count\").html(this.count)\n        else\n          $(\"#subscriber_count\").html(\"ban/error\")\n      }\n      else if (data[\"username\"] == \"notification\") {\n        if (data[\"messageContent\"] == \"refresh\") {\n          if ($(\"#chat-top-bar > p#center\").html() != 'notification') {\n            bus.trigger(\"notificationReceived\", this)\n          } else {\n            bus.trigger(\"notificationSelected\", this)\n          }\n        }\n        else if (data[\"messageContent\"] == \"battle-start\") {\n          router.navigate(`connected/game?game_id=${data[\"battle_id\"]}`, { trigger: true });\n        }\n      }\n      else if (data[\"username\"] == \"personnal-chat\") {\n        if ($(\"#chat-top-bar > p#center\").attr(\"friend-chat-open\") != undefined) {\n          if (data[\"forwarder\"] == $(\"#chat-top-bar > p#center\").html() || data[\"forwarder\"] == Cookies.get(\"pseudo\")) {\n            var down = false;\n            if ($('#message-container').scrollTop() + $('#message-container').innerHeight() >= $('#message-container')[0].scrollHeight) {\n              down = true;\n            }\n            var date = new Date(data[\"date\"]);\n            var date_string = date.getDay() + '/' + date.getMonth() + '/' + date.getFullYear() + '  ' + date.getHours() + ':' + date.getMinutes();\n            $(\"#message-container\").append('<li class=\"message\"><p class=\"user-message\">' + data[\"forwarder\"] + '</p><p class=\"time-message\">' + date_string + '</p><br><p class=\"content-message\">' + data[\"messageContent\"] + '</p></li>')\n            if (down == true)\n              $(\"#message-container\").scrollTop($(\"#message-container\")[0].scrollHeight);\n          }\n        }\n      }\n      else if (data[\"username\"] == \"friend-status\") {\n        bus.trigger(\"refreshFriendsList\", data)\n      }\n      else if (data[\"username\"] == \"channel-ban\") {\n        bus.trigger(\"chatroomRefresh\", data)\n        alert('vous avez etait banni du chatroom [' + data[\"messageContent\"] + ']')\n      }\n      else if (data[\"username\"] == \"channel-unban\") {\n        bus.trigger(\"chatroomRefresh\", data)\n        alert('vous avez etait debanni du chatroom [' + data[\"messageContent\"] + ']')\n      }\n      else {\n        var date = new Date(data[\"date\"]);\n        var date_string = date.getDay() + '/' + date.getMonth() + '/' + date.getFullYear() + '  ' + date.getHours() + ':' + date.getMinutes();\n\n        var down = false;\n        if ($('#message-container').scrollTop() + $('#message-container').innerHeight() >= $('#message-container')[0].scrollHeight) {\n          down = true;\n        }\n        $(\"#message-container\").append('<li class=\"message\"><p class=\"user-message\">' + data[\"username\"] + '</p><p class=\"time-message\">' + date_string + '</p><br><p class=\"content-message\">' + data[\"messageContent\"] + '</p></li>')\n        if (down == true)\n          $(\"#message-container\").scrollTop($(\"#message-container\")[0].scrollHeight);\n      }\n    }\n  });\n  return (new_channel);\n}\n\nexport { channel_gen }\n"]},"metadata":{},"sourceType":"module"}