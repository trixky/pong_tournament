{"ast":null,"code":"import { router } from \"../BackboneRouter/application_router\";\nimport { getUrlParam } from \"../utils/utils_1\";\nimport { User } from \"../BackboneModel/user_model\";\nvar SettingsContent = Backbone.View.extend({\n  events: {\n    \"click #saveImageButton\": \"updateUser\",\n    \"change #fileUpload\": \"confirmUpload\",\n    \"click #disable2FA\": \"disable2FA\"\n  },\n  render: function render() {\n    this.$el.html(\"\\n        <div id=\\\"flex_div\\\">\\n            <h2 id=\\\"settingsTitle\\\"> Settings </h2>\\n            <div class=\\\"CheckBox\\\">\\n                <p> enable two factor auth </p>\\n                <input id=\\\"TwoFactor\\\" type=\\\"checkbox\\\"/>\\n            </div>\\n            <div class=\\\"CheckBox\\\">\\n                <p> select an avatar image </p>\\n                <label id=\\\"fileLabel\\\" for=\\\"fileUpload\\\"> Select a file </label>\\n                <input id=\\\"fileUpload\\\" type=\\\"file\\\" accept=\\\"image/*\\\"/>\\n            </div>\\n            <button id=\\\"saveImageButton\\\"> save </button>\\n        </div>\\n        \");\n    var user = new User({\n      id: Cookies.get(\"login\")\n    });\n    user.fetch().then(function (res) {\n      if (res[\"two_factor\"] == true) $('#TwoFactor').prop('checked', true);\n    });\n    return this;\n  },\n  confirmUpload: function confirmUpload() {\n    $(\"#fileLabel\").css(\"background-color\", \"#93E493\");\n    $(\"#fileLabel\").html(\"file selected\");\n  },\n  updateUser: function updateUser(e) {\n    var _this = this;\n\n    var user = new User({\n      id: Cookies.get(\"login\")\n    });\n    user.fetch();\n    var formData = new FormData();\n    var i = 0;\n\n    if (document.getElementById(\"fileUpload\").files.length > 0) {\n      i = 1;\n      var file = document.getElementById(\"fileUpload\").files[0];\n      var blob = new Blob([file]);\n      formData.append(\"avatar_pers\", blob);\n    }\n\n    if (!$(\"#TwoFactor\").is(\":checked\")) {\n      formData.append(\"two_factor\", $(\"#TwoFactor\").is(\":checked\"));\n      axios({\n        url: \"/api/users/\".concat(user.attributes.id),\n        method: \"PATCH\",\n        data: formData\n      }).then(function (res) {\n        if (i == 1) Cookies.set(\"url\", res.data.url);\n\n        _this.removeQRcode();\n      });\n    } else {\n      axios({\n        url: \"/api/users/\".concat(user.attributes.id),\n        method: \"PATCH\",\n        data: formData\n      }).then(function (res) {\n        if (i == 1) Cookies.set(\"url\", res.data.url);\n        if ($(\"#TwoFactor\").is(\":checked\")) _this.displayQRCode();\n      });\n    }\n  },\n  displayQRCode: function displayQRCode() {\n    var _this2 = this;\n\n    axios.post(\"/api/twofactor\").then(function (res) {\n      if (res.data[\"error\"]) {\n        router.navigate(\"connected/play\", {\n          trigger: true\n        });\n        return;\n      }\n\n      $(\"body\").append(\"<div class=\\\"BackClick\\\"></div>\");\n      $(\".BackClick\").click(function () {\n        _this2.removePopUp();\n      });\n      $(\".Center\").append(\"\\n            <div class=\\\"PopUp\\\" id=\\\"qrCodePopUp\\\">\\n                <img id=\\\"imageQRcode\\\" src=\\\"http://chart.apis.google.com/chart?cht=qr&chs=300x300&chl=\".concat(res.data[\"uri\"], \"\\\"/>\\n            </div>\"));\n    });\n  },\n  removePopUp: function removePopUp() {\n    $(\"#qrCodePopUp\").remove();\n    $(\".BackClick\").remove();\n    router.navigate(\"connected/play\", {\n      trigger: true\n    });\n  },\n  removeQRcode: function removeQRcode() {\n    var _this3 = this;\n\n    axios.get(\"/api/users/\".concat(Cookies.get(\"login\"))).then(function (res) {\n      if (res.data[\"two_factor\"] == true) {\n        $(\"body\").append(\"<div class=\\\"BackClick\\\"></div>\");\n        $(\".BackClick\").click(function () {\n          _this3.removePopUp();\n        });\n        $(\".Center\").append(\"\\n                <div class=\\\"PopUp\\\" id=\\\"2faDisablePopUp\\\">\\n                    <h1> Enter google authentification code to disable 2FA </h1>\\n                    <input id=\\\"twoFactorCode\\\" placeholder=\\\"two factor code\\\"/>\\n                    <button id=\\\"disable2FA\\\">Confirm</button>\\n                </div>\");\n      } else _this3.removePopUp();\n    });\n  },\n  disable2FA: function disable2FA() {\n    var _this4 = this;\n\n    var code = $(\"#twoFactorCode\").val();\n    axios[\"delete\"](\"/api/twofactor/\".concat(Cookies.get(\"login\"), \"?code=\").concat(code)).then(function (res) {\n      if (res.data[\"success\"]) _this4.removePopUp();else {\n        if (!$(\"#errorCreate\").length) $(\"#2faDisablePopUp\").append(\"\\n                        <p id=\\\"errorCreate\\\"> error: incorrect code </p>\\n                    \");\n      }\n    });\n  }\n});\nvar settingsContent = new SettingsContent({\n  el: \".Center\"\n});\nexport { settingsContent };","map":{"version":3,"sources":["/home/mathis/Documents/no_docker/app/javascript/BackboneViews/SettingsView.js"],"names":["router","getUrlParam","User","SettingsContent","Backbone","View","extend","events","render","$el","html","user","id","Cookies","get","fetch","then","res","$","prop","confirmUpload","css","updateUser","e","formData","FormData","i","document","getElementById","files","length","file","blob","Blob","append","is","axios","url","attributes","method","data","set","removeQRcode","displayQRCode","post","navigate","trigger","click","removePopUp","remove","disable2FA","code","val","settingsContent","el"],"mappings":"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","sourcesContent":["import {router} from \"../BackboneRouter/application_router\";\nimport {getUrlParam} from \"../utils/utils_1\"\nimport {User} from \"../BackboneModel/user_model\"\n\nvar SettingsContent = Backbone.View.extend({\n    events:\n    {\n        \"click #saveImageButton\" : \"updateUser\",\n        \"change #fileUpload\" : \"confirmUpload\",\n        \"click #disable2FA\" : \"disable2FA\"\n    },\n    render : function()\n    {\n        this.$el.html(`\n        <div id=\"flex_div\">\n            <h2 id=\"settingsTitle\"> Settings </h2>\n            <div class=\"CheckBox\">\n                <p> enable two factor auth </p>\n                <input id=\"TwoFactor\" type=\"checkbox\"/>\n            </div>\n            <div class=\"CheckBox\">\n                <p> select an avatar image </p>\n                <label id=\"fileLabel\" for=\"fileUpload\"> Select a file </label>\n                <input id=\"fileUpload\" type=\"file\" accept=\"image/*\"/>\n            </div>\n            <button id=\"saveImageButton\"> save </button>\n        </div>\n        `);\n        var user = new User({id: Cookies.get(\"login\")});\n        user.fetch().then((res)=>\n        {\n            if (res[\"two_factor\"] == true)\n                $('#TwoFactor').prop('checked', true);\n        })\n        return this;\n    },\n    confirmUpload: function()\n    {\n        $(\"#fileLabel\").css(\"background-color\", \"#93E493\");\n        $(\"#fileLabel\").html(\"file selected\");\n    },\n    updateUser: function(e)\n    {\n        var user = new User({id: Cookies.get(\"login\")});\n        user.fetch();\n        const formData = new FormData();\n        var i = 0;\n        if (document.getElementById(\"fileUpload\").files.length > 0)\n        {\n            i = 1;\n            var file = document.getElementById(\"fileUpload\").files[0];\n            var blob = new Blob([file]);\n            formData.append(\"avatar_pers\", blob);\n        }\n        if (!$(\"#TwoFactor\").is(\":checked\"))\n        {\n            formData.append(\"two_factor\", $(\"#TwoFactor\").is(\":checked\"));\n            axios({\n                url: `/api/users/${user.attributes.id}`,\n                method: \"PATCH\",\n                data: formData\n            }).then((res)=>{\n                if (i == 1)\n                    Cookies.set(\"url\", res.data.url);\n                this.removeQRcode();\n            })\n        }\n        else\n        {\n            axios({\n                url: `/api/users/${user.attributes.id}`,\n                method: \"PATCH\",\n                data: formData\n            }).then((res)=>{\n                if (i == 1)\n                    Cookies.set(\"url\", res.data.url);\n                if ($(\"#TwoFactor\").is(\":checked\"))\n                    this.displayQRCode();\n                });\n        }\n    },\n    displayQRCode: function ()\n    {\n        axios.post(`/api/twofactor`).then((res)=>{\n            if (res.data[\"error\"])\n            {\n                router.navigate(`connected/play`, {trigger: true});\n                return ;\n            }\n            $(\"body\").append(`<div class=\"BackClick\"></div>`);\n            $(\".BackClick\").click(()=>{\n                this.removePopUp();\n            });\n            $(\".Center\").append(`\n            <div class=\"PopUp\" id=\"qrCodePopUp\">\n                <img id=\"imageQRcode\" src=\"http://chart.apis.google.com/chart?cht=qr&chs=300x300&chl=${res.data[\"uri\"]}\"/>\n            </div>`)\n        });\n    },\n    removePopUp: function ()\n    {\n        $(\"#qrCodePopUp\").remove();\n        $(\".BackClick\").remove();\n        router.navigate(`connected/play`, {trigger: true});\n    },\n    removeQRcode: function ()\n    {\n        axios.get(`/api/users/${Cookies.get(\"login\")}`).then((res)=>{\n            if (res.data[\"two_factor\"] == true)\n            {\n                $(\"body\").append(`<div class=\"BackClick\"></div>`);\n                $(\".BackClick\").click(()=>{\n                    this.removePopUp();\n                });\n                $(\".Center\").append(`\n                <div class=\"PopUp\" id=\"2faDisablePopUp\">\n                    <h1> Enter google authentification code to disable 2FA </h1>\n                    <input id=\"twoFactorCode\" placeholder=\"two factor code\"/>\n                    <button id=\"disable2FA\">Confirm</button>\n                </div>`)\n            }\n            else\n                this.removePopUp();\n\n        });\n    },\n    disable2FA: function()\n    {\n        var code = $(\"#twoFactorCode\").val();\n        axios.delete(`/api/twofactor/${Cookies.get(\"login\")}?code=${code}`).then((res)=>{\n            if (res.data[\"success\"])\n                this.removePopUp();\n            else\n            {\n                if (!$(\"#errorCreate\").length)\n                    $(\"#2faDisablePopUp\").append(`\n                        <p id=\"errorCreate\"> error: incorrect code </p>\n                    `)\n            }\n        });\n    }\n})\n\nvar settingsContent = new SettingsContent({el: \".Center\"});\n\nexport {settingsContent}"]},"metadata":{},"sourceType":"module"}